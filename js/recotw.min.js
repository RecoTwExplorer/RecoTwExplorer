var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},RecoTwExplorer;!function(e){"use strict";var t="RecoTw Explorer",n="2.40";$.fn.shake=function(e,t,n){return this.each(function(){for(var r=$(this),o=0;e>o;o++)r.animate({left:-t},n/e/4).animate({left:t},n/e/2).animate({left:0},n/e/4)})};var r=function(){function e(){}return e.INCORRECT_REGEX="指定された正規表現は正しくありません。",e.INCORRECT_URL_OR_ID="指定された URL または ID は正しくありません。",e.BADGE_NOT_SUPPORTED="通知バッジがサポートされていません。",e.FAILED_TO_GENERATE_STATUS_URL="ツイートの URL を生成できません。",e.FAILED_TO_GENERATE_USER_URL="ユーザーへの URL を生成できません。",e.FAILED_TO_GENERATE_PROFILE_IMAGE_URL="プロフィール画像の URL を生成できません。",e.FAILED_TO_LOAD_EMBEDDED_TWEET="Twitter 埋め込みツイートの読み込みに失敗しました。",e.REGISTER_NEW_TWEET="ツイートの ID または URL:",e.REGISTRATION_FAILED_HTML="<strong>登録失敗</strong><br>{0}",e.SEARCH_HELP_HTML="<dl><dt>ツイート検索</dt><dd><code>/</code> と <code>/</code> で囲むと正規表現検索</dd><dt>ユーザー名検索</dt><dd><code>from:</code> でユーザーを検索<br>カンマ区切りで複数入力</dd><dt>ID 検索</dt><dd><code>id:</code> で ID 検索</dd></dl>",e.STATISTICS_TABLE_HTML='<span class="statistics-table-header" style="border-color: #{0:X6};"><a href="javascript:void(0);">{1}</a> ({2})&nbsp;&nbsp;&ndash;&nbsp;&nbsp;{3:P1}</span><br>',e.TWEET_TIME_HTML='<a href="{0}" target="_blank"><time datetime="{2}" title="投稿時刻: {1:U} (UTC)">{1:yyyy年M月d日 HH:mm}</time></a>',e.TWEET_REMOVED_HTML='<blockquote>ツイートは削除されたか、または非公開に設定されています。<hr><div><img src="{0}"><span><a href="{1}" target="_blank">@{2}</a></span><p>{3}</p><p class="tweet-date">{4}</p></div></blockquote>',e.LINK_TO_URL_HTML='<a href="{0}" target="_blank">{0}</a>',e.URL_INPUT_AREA=$("#new-record-form .modal-body").html(),e.URL_INPUT_REGEX=new RegExp($(".url-box").attr("pattern")),e.USERNAME="ユーザ名",e.TWEETS_COUNT="ツイート数",e.NO_RESULT='<p class="text-center" style="margin-top: 200px;">該当ユーザーなし</p>',e.SEARCH_RESULT="検索結果: {0}",e.STATISTICS_COUNT="({0:N0} 件)",e.STATISTICS_COUNT_FILTERED="({0:N0} / {1:N0} 件)",e.PAGE_TITLE_SEARCH_RESULT="検索結果: {0} - "+t,e.PAGE_TITLE_NORMAL=t,e.POST_ERRORS={400:"パラメーターが正しくありません。",403:"ツイートの取得に失敗しました。",404:"指定されたツイートは存在しません。",500:"すでに登録されているツイートです。",503:"サーバーで問題が発生しています。",UNKNOWN_ERROR:"原因不明のエラーです。"},e}(),o=function(){function e(e,t,n,r,o,i){void 0===e&&(e=[]),void 0===t&&(t=""),void 0===n&&(n=null),void 0===r&&(r=!1),void 0===o&&(o=2),void 0===i&&(i=1),this.usernames=e,this.body=t,this.id=n,this.regex=r,this.order=o,this.orderBy=i}return e.prototype.isFilteredByUsernames=function(){return void 0!==this.usernames&&this.usernames.length>0},e.prototype.isFilteredByID=function(){return void 0!==this.id&&null!==this.id},e.prototype.isFilteredByBody=function(){return void 0!==this.body&&this.body.length>0},e.prototype.isFiltered=function(){return this.isFilteredByUsernames()||this.isFilteredByID()||this.isFilteredByBody()},e.prototype.toQueryString=function(){var e=[];return this.isFilteredByUsernames()&&(e[e.length]="username="+encodeURIComponent(this.usernames.join(","))),this.isFilteredByID()&&(e[e.length]="id="+encodeURIComponent(this.id)),this.isFilteredByBody()&&(e[e.length]=this.regex?"body="+encodeURIComponent("/"+this.body+"/"):"body="+encodeURIComponent(this.body)),e.length>0?"?"+e.join("&"):""},e.prototype.toKeywords=function(){var e=[];return this.isFilteredByUsernames()&&(e[e.length]="from:"+this.usernames.join(",")),this.isFilteredByID()&&(e[e.length]="id:"+this.id),this.isFilteredByBody()&&(e[e.length]=this.regex?"/"+this.body+"/":this.body),e.join(" ")},e.fromQueryString=function(t,n,r){var o=new e([],"",null,!1,n,r);if(0===t.length||"?"===t)return o;var i=t.substring(1).split("&").map(function(e){return e.split("=")}).filter(function(e){return 2===e.length}).map(function(e){return{property:e[0],value:decodeURIComponent(e[1])}});return i.filter(function(e){return"body"===e.property}).forEach(function(e){var t;null!==(t=e.value.match(/^\/(.*)\/$/))?(o.body=t[1],o.regex=!0):(o.body=e.value,o.regex=!1)}),i.filter(function(e){return"username"===e.property}).forEach(function(e){return o.usernames=e.value.split(",")}),i.filter(function(e){return"id"===e.property}).forEach(function(e){return o.id=e.value}),o},e.fromKeywords=function(t,n,r){for(var o,i=new e([],"",null,!1,n,r),a=t.split(" "),s=0;s<a.length;s++)null===(o=a[s].match(/^from:([a-zA-Z0-9_]+(?:,[a-zA-Z0-9_]+)*)$/))?null===(o=a[s].match(/^id:(\d+)$/))?i.body+=a[s]:i.id=o[1]:i.usernames=o[1].split(",");return null!==(o=i.body.match(/^\/(.*)\/$/))&&(i.body=o[1],i.regex=!0),i},e}(),i=function(){function e(e){var t=this;this._length=e.count(),this._users=e.groupBy(function(e){return e.target_id}).select(function(e){return{entry:e.firstOrDefault(),count:e.count()}}).select(function(e){return{target_sn:e.entry.target_sn,count:e.count,percentage:e.count/t._length}}).orderByDescending(function(e){return e.count}).thenBy(function(e){return e.target_sn.toLowerCase()}).toArray(),this._table=new google.visualization.DataTable({cols:[{type:"string",label:r.USERNAME},{type:"number",label:r.TWEETS_COUNT}],rows:this.users.map(function(e){return{c:[{v:e.target_sn},{v:e.count}]}})})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"users",{get:function(){return this._users},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!0,configurable:!0}),e}(),a=function(){function e(e,t,n){var r=this;this._elements=e||[],this._userIDs=t||null,this._enumerable=n||Enumerable.from(e),null===t&&(this._userIDs=this.enumerable.toDictionary(function(e){return e.target_id},function(e){return e.target_sn}),this.enumerable.forEach(function(e){return e.target_sn=r._userIDs.get(e.target_id)}))}return Object.defineProperty(e.prototype,"length",{get:function(){return this._elements.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enumerable",{get:function(){return this._enumerable},enumerable:!0,configurable:!0}),e.prototype.add=function(e){if(!e)throw new Error;(0===this._elements.length||+e.id>+this._elements[this._elements.length-1].id)&&(this._elements[this._elements.length]=e)},e.prototype.addRange=function(e){e.forEach(this.add.bind(this))},e.prototype.clone=function(){return new e(this._elements,this._userIDs,this.enumerable)},e.prototype.reset=function(){return new e(this._elements,this._userIDs)},e.prototype.createStatistics=function(){return new i(this.enumerable)},e.prototype.sort=function(e){var t=this.clone();if(!e)return t;var n=e.order||2,r=e.orderBy||1,o=function(e,t){return e-t};switch(!0){case 1===n&&1===r:t._enumerable=t.enumerable.orderBy(function(e){return e.record_date});break;case 1===n&&2===r:t._enumerable=t.enumerable.orderBy(function(e){return e.tweet_id},o);break;case 2===n&&1===r:t._enumerable=t.enumerable.orderByDescending(function(e){return e.record_date});break;case 2===n&&2===r:t._enumerable=t.enumerable.orderByDescending(function(e){return e.tweet_id},o);break;case 3===n:t._enumerable=t.enumerable.shuffle()}return t},e.prototype.filter=function(e){var t=this.clone();if(void 0===e||null===e)return t;var n;if(void 0!==e.body&&e.body.length>0)if(e.regex){try{n=new RegExp(e.body,"i")}catch(o){throw new Error(r.INCORRECT_REGEX)}t._enumerable=t.enumerable.where(function(e){return n.test(e.content)})}else e.body=e.body.toLowerCase(),t._enumerable=t.enumerable.where(function(t){return t.content.toLowerCase().contains(e.body)});return void 0!==e.usernames&&e.usernames.length>0&&(t._enumerable=t.enumerable.where(function(t){return e.usernames.some(function(e){return t.target_sn.toLowerCase()===e.toLowerCase()})})),null!==e.id&&(t._enumerable=t.enumerable.where(function(t){return t.tweet_id===e.id})),t},e}(),s=function(){function e(){}return e.init=function(){e.load();try{e._favico=new Favico({animation:"slide"})}catch(t){console.log(r.BADGE_NOT_SUPPORTED)}},e.load=function(){var t=[],n=localStorage?localStorage.getItem("entries"):null;n&&(t=JSON.parse(n)),e.fetchLatestEntries(t).then(f.onEntriesLoaded,f.onEntriesLoadFailed)},e.save=function(){localStorage&&e.entries&&localStorage.setItem("entries",JSON.stringify(e.entries.reset().enumerable.toArray()))},Object.defineProperty(e,"entries",{get:function(){return null===e._entries?null:e._entries},enumerable:!0,configurable:!0}),Object.defineProperty(e,"latestEntry",{get:function(){return null===e.entries?null:e.entries.reset().enumerable.lastOrDefault()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"statistics",{get:function(){return null===e.entries?null:null!==e._statistics?e._statistics:e._statistics=e.entries.createStatistics()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"options",{set:function(t){null!==e.entries&&(e._entries=e.entries.reset().sort(t).filter(t),e._statistics=null)},enumerable:!0,configurable:!0}),e.isMobile=function(){return/iPhone|iP[ao]d|Android|Windows.*Phone/.test(navigator.userAgent)},e.createIDfromURL=function(t){var n;if(void 0===t||null===t||0===t.length)return null;if("string"==typeof t){if(null!==(n=t.match(r.URL_INPUT_REGEX)))return n[1]||n[2]}else if(Array.isArray(t)){var o=t.map(e.createIDfromURL);if(!o.every(function(e){return null===e}))return o}throw new Error(r.INCORRECT_URL_OR_ID)},e.fetchLatestEntries=function(t){var n;null!==e.entries?n=+e.latestEntry.id+1:t&&t.length>0&&(n=+t[t.length-1].id+1);var r=$.Deferred();return $.ajax({url:e.RECOTW_GET_ALL_URL,dataType:"json",data:{since_id:n}}).done(function(n,o,i){null===e.entries&&(e._entries=new a(t)),n.length>0&&e.entries.addRange(n),r.resolve(n)}).fail(function(e,t,n){r.reject(e)}),r.promise()},e.registerEntries=function(t){var n=$.Deferred(),o=e.createIDfromURL(t);return $.ajax({url:this.RECOTW_POST_URL,type:"POST",data:{id:o[0]},dataType:"json"}).done(function(t,r,o){+t.id===+e.latestEntry.id+1&&(delete t.result,e.entries.add(t),f.onNewEntries(1)),n.resolve(t)}).fail(function(e,t,o){var i=e.responseJSON;n.reject(i&&i.errors?r.POST_ERRORS[i.errors[0].code]||i.errors[0].message:r.POST_ERRORS.UNKNOWN_ERROR)}),n.promise()},e.createStatusURL=function(t){if("string"==typeof t)return String.format(e.TWITTER_STATUS_URL,t);if(void 0!==t.target_sn&&void 0!==t.tweet_id)return String.format(e.TWITTER_STATUS_URL.replace("show",t.target_sn),t.tweet_id);throw new Error(r.FAILED_TO_GENERATE_STATUS_URL)},e.createUserURL=function(t){if("string"==typeof t)return String.format(e.TWITTER_USER_URL,t);if(void 0!==t.target_sn)return e.createUserURL(t.target_sn);throw new Error(r.FAILED_TO_GENERATE_USER_URL)},e.createProfileImageURL=function(t){if(null===t)return e.ALTERNATIVE_ICON_URL;if("string"==typeof t)return String.format(e.TWITTER_PROFILE_IMAGE_URL,t);if(void 0!==t.target_sn)return e.createProfileImageURL(t.target_sn);throw new Error(r.FAILED_TO_GENERATE_PROFILE_IMAGE_URL)},e.createDateByTweetID=function(t){if("string"==typeof t){var n=(+t).toString(2);return new Date(parseInt(n.substr(0,n.length-22),2)+e.TWITTER_SNOWFLAKE_EPOCH)}return void 0!==t.tweet_id?e.createDateByTweetID(t.tweet_id):null},e.setSearchQueryString=function(e){history&&history.pushState?history.pushState(null,null,location.pathname+e.toQueryString()):location.hash=e.toQueryString().slice(1)},e.startPolling=function(){null===e._pollingID&&(e._pollingID=window.setInterval(function(){e.fetchLatestEntries().done(function(e){e.length>0&&f.onNewEntries(e.length)}).fail(function(e){console.log(e)})},e.POLLING_INTERVAL))},e.stopPolling=function(){window.clearInterval(e._pollingID),e._pollingID=null},Object.defineProperty(e,"notificationCount",{get:function(){return e._notificationCount},enumerable:!0,configurable:!0}),e.createNotification=function(t){if(!(0>t)){e._notificationCount+=t;try{e._favico.badge(e._notificationCount)}catch(n){console.log(r.BADGE_NOT_SUPPORTED)}}},e.clearNotification=function(){e._notificationCount=0;try{e._favico.reset()}catch(t){console.log(r.BADGE_NOT_SUPPORTED)}},e.ALTERNATIVE_ICON_URL="./images/none.png",e.TWITTER_STATUS_URL="https://twitter.com/show/status/{0}",e.TWITTER_USER_URL="https://twitter.com/{0}",e.TWITTER_PROFILE_IMAGE_URL="http://www.paper-glasses.com/api/twipi/{0}/",e.RECOTW_GET_ALL_URL="http://api.recotw.black/1/tweet/get_tweet_all",e.RECOTW_POST_URL="http://api.recotw.black/1/tweet/record_tweet",e.RECOTW_COUNT_URL="http://api.recotw.black/1/tweet/count_tweet",e.POLLING_INTERVAL=2e4,e.TWITTER_SNOWFLAKE_EPOCH=1288834974657,e._entries=null,e._statistics=null,e._pollingID=null,e._notificationCount=0,e._favico=null,e}(),c=function(){function e(e){var t=this;this._id=e,this._$element=$("a[href='#"+e+"']").on("shown.bs.tab",function(){window.scrollTo(0,0),t.render()})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this.id===$(".tab-pane.active").attr("id")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._$element},enumerable:!0,configurable:!0}),e.prototype.show=function(){this._$element.tab("show")},e.prototype.render=function(){this.rendered=!0},e.prototype.clear=function(){this.rendered=!1},e}(),l=function(e){function t(){e.call(this,"home-tab"),this._current=0,this._widgetID=-1}return __extends(t,e),t.prototype.render=function(n,r){var o=this;if(n||r||!this.rendered){$("#no-result-container").hide(),f.loading=!1;var i,a=$("#main-area"),c=s.entries.enumerable;if(c.isEmpty())return void $("#no-result-container").fadeIn();r?(c=c.take(r),i=$("<div></div>").prependTo(a)[0]):(c=c.skip(this._current).take(t.TWEETS_COUNT),i=a[0]),twttr.ready(function(){return c.forEach(function(e){return o.renderTweet(e,i)})}),this._current+=r||t.TWEETS_COUNT,e.prototype.render.call(this)}},t.prototype.renderTweet=function(e,n){var r=this,o=++this._widgetID;twttr.widgets.createTweet(e.tweet_id,n,t.WIDGET_OPTIONS).then(function(t){if(t){var n=$(t).contents();n.find(".Tweet-brand .u-hiddenInNarrowEnv").hide(),n.find(".Tweet-brand .u-hiddenInWideEnv").css("display","inline-block"),n.find(".Tweet-author").css("max-width","none")}else r.showStatusLoadFailedMessage(o,e)})},t.prototype.replaceLinkToURL=function(e){return e.replace(/[\r\n]/g,"<br>").replace(/https?:\/\/t\.co\/[A-Za-z0-9]+/g,function(e){return String.format(r.LINK_TO_URL_HTML,e)})},t.prototype.showStatusLoadFailedMessage=function(e,t){var n=s.createDateByTweetID(t),o=String.format(r.TWEET_TIME_HTML,s.createStatusURL(t),n,n.toISOString()),i=$(String.format(r.TWEET_REMOVED_HTML,s.createProfileImageURL(t),s.createUserURL(t),t.target_sn,this.replaceLinkToURL(t.content),o));$("#twitter-widget-"+e).after(i).remove(),i.find("img").on("error",function(e){return e.target.src=s.createProfileImageURL(null)})},t.prototype.clear=function(){this._current=0,$("#main-area").empty(),e.prototype.clear.call(this)},t.TWEETS_COUNT=25,t.WIDGET_OPTIONS={lang:"ja",linkColor:"#774c80"},t}(c),u=function(e){function t(){e.call(this,"statistics-tab"),this._chart=null}return __extends(t,e),Object.defineProperty(t.prototype,"chart",{get:function(){return null===this._chart&&(this._chart=new google.visualization.PieChart($("#statistics-chart")[0]),google.visualization.events.addListener(this._chart,"click",f.onChartSliceClick)),this._chart},enumerable:!0,configurable:!0}),t.prototype.render=function(t){var n=this;if(s.isMobile()||void 0!==t||($("#statistics-filter-textbox").focus(),$("#statistics-table").delay(100).animate({scrollTop:0},400)),!(null===s.entries||void 0===t&&c.statistics.rendered)){$("#no-result-container").hide(),void 0===t&&this.renderChart();var o=s.statistics.users.map(function(e,t){return{html:n.generateTableRow(e,t),screenName:e.target_sn.toLowerCase()}}).filter(function(e){return void 0===t||e.screenName.startsWith(t)});$("#statistics-table").html(o.length>0?o.map(function(e){return e.html}).join(""):r.NO_RESULT),e.prototype.render.call(this)}},t.prototype.renderChart=function(){var e=f.getOptions();return e.isFiltered()?($("#statistics-filter").text(String.format(r.SEARCH_RESULT,e.toKeywords())),$("#statistics-count").text(String.format(r.STATISTICS_COUNT_FILTERED,s.statistics.length,s.entries.length))):($("#statistics-filter").text(""),$("#statistics-count").text(String.format(r.STATISTICS_COUNT,s.statistics.length))),0===s.statistics.length?($("#statistics-chart").hide(),void $("#no-result-container").fadeIn()):($("#statistics-chart").show(),void this.chart.draw(s.statistics.table,t.GRAPH_OPTIONS))},t.prototype.generateTableRow=function(e,n){return String.format(r.STATISTICS_TABLE_HTML,e.percentage>t.GRAPH_OPTIONS.sliceVisibilityThreshold?t.GRAPH_COLORS[n+1]:t.GRAPH_COLORS[0],e.target_sn,e.count,e.percentage)},t.prototype.clear=function(){$("#statistics-table").empty(),e.prototype.clear.call(this)},t.prototype.applySearchFilter=function(t){var n=f.getOptions();n.usernames=[t],f.setOptions(n,!0,!0,!0),e.prototype.clear.call(this),c.home.show()},t.prototype.applyChartFilter=function(e){this.render(e.toLowerCase())},t.GRAPH_COLORS=[13421772,3368652,14432530,16750848,1087e3,10027161,39366,14500983,6728192,12070446,3236757,10044569,2271897,11184657,6697932,15102720,9111303,6623335,3314274,5600422,3882668,12022562,1496608,12129155,16004510,10246453,11125779,2783117,6720796,12493843,809250,7615505],t.GRAPH_OPTIONS={backgroundColor:"#FEFEFE",chartArea:{width:"90%",height:"100%"},is3D:!0,legend:"none",sliceVisibilityThreshold:.0095},t}(c),d=function(){function e(){}return Object.defineProperty(e,"title",{set:function(t){e._title=t=t||e._title,(""===location.hostname||"localhost"===location.hostname)&&(t="[DEBUG] "+t),s.notificationCount>0&&(t="* "+t),document.title=t},enumerable:!0,configurable:!0}),e.setSearchKeywords=function(e){$("#search-box").val(e.toKeywords())},e.postEntriesFromModal=function(){var e=$("#new-record-modal input[type='text']").map(function(){return $(this).val()}).get();try{s.registerEntries(e.filter(function(e){return e.length>0})).then(f.onRegistrationSucceeded,f.onRegistrationFailed),$("#new-record-modal").modal("hide")}catch(t){$("#inputPostStatus").val("").focus(),$("#new-record-modal .modal-dialog").shake(2,18,300)}},e.postEntriesFromDialog=function(e){try{s.registerEntries([e]).then(f.onRegistrationSucceeded,f.onRegistrationFailed)}catch(t){window.alert(t.message)}},e._title=r.PAGE_TITLE_NORMAL,e}(),f=function(){function e(){}return e.getOptions=function(){return e._options},e.setOptions=function(t,n,o,i){try{s.options=e._options=t}catch(a){return void console.log(a.message)}o&&s.setSearchQueryString(t),i&&d.setSearchKeywords(t),t.isFiltered()?($("#clear-search-filter").show(),d.title=String.format(r.PAGE_TITLE_SEARCH_RESULT,t.toKeywords())):($("#clear-search-filter").hide(),d.title=r.PAGE_TITLE_NORMAL),$("#statistics-filter-textbox").val(""),null!==s.entries&&(c.statistics.active?(c.home.clear(),n||e.reload()):e.reload())},e.main=function(){d.title=r.PAGE_TITLE_NORMAL,$("#app-version").text(n),window.innerHeight>=window.screen.height&&navigator.standalone&&$(document.body).addClass("standalone"),s.init(),c.home=new l,c.statistics=new u,e.setOptions(o.fromQueryString(location.search,2,1),!1,!1,!0),google.load("visualization","1.0",{packages:["corechart"]}),$("#loading-recotw").show();var t=$(window);t.unload(s.save),t.bottom({proximity:.05}),t.on("bottom",function(){c.home.active&&e.onPageBottom()}),t.on("popstate",function(){e.setOptions(o.fromQueryString(location.search,e.order,e.orderBy),!1,!1,!0)}),c.home.element.click(function(){var t=s.notificationCount;c.home.active&&t>0&&(s.clearNotification(),e.onNotificationStatusChanged(),e.showNewStatuses(t))}),$(".navbar-brand, #clear-search-filter").click(function(){e.setOptions(o.fromKeywords("",e.order,e.orderBy),!1,!0,!0)}),$("[id^='order-by-']").change(function(){e.getOptions().order=e.order,e.getOptions().orderBy=e.orderBy,e.setOptions(e.getOptions(),!0,!1,!1)}),$("#order-shuffle").click(function(){e.getOptions().order=e.order,e.setOptions(e.getOptions(),!0,!1,!1)}),$("#search-form").submit(function(t){t.preventDefault(),e.setOptions(o.fromKeywords($("#search-box").val(),e.order,e.orderBy),!1,!0,!1)}),$("#search-form-toggle-button").click(function(){var e=$(this),t=$("#search-form"),n=$("#page-main");e.hasClass("active")?(e.removeClass("active"),n.removeClass("main-search-active"),t.css({display:""})):(e.addClass("active"),n.addClass("main-search-active"),t.css({cssText:"display: block !important"}))}),$("#new-record-toggle-button").click(function(){if(navigator.standalone){var e=window.prompt(r.REGISTER_NEW_TWEET);null!==e&&d.postEntriesFromDialog(e)}else $("#new-record-modal").modal("show")}),$("#new-record-form").submit(function(e){e.preventDefault(),d.postEntriesFromModal()}),$("#new-record-modal").on("shown.bs.modal",function(){$("#new-record-form .url-box").focus()}),$("#new-record-modal").on("hidden.bs.modal",function(){$("#new-record-form .modal-body").empty().html(r.URL_INPUT_AREA)}),$("#new-record-modal").on("keyup change input",".url-box",function(){e.onNewRecordFormTextBoxValueChanged()}),$("#statistics-filter-textbox").on("keyup change input",function(e){c.statistics.applyChartFilter(e.target.value)}),$("#statistics-table").on("mousedown",".statistics-table-header a",function(e){c.statistics.applySearchFilter(e.target.textContent)}),$("#search-box").popover({placement:"bottom",html:!0,content:r.SEARCH_HELP_HTML}).blur(function(){$(this).popover("hide")}).keydown(function(e){(13===e.keyCode||27===e.keyCode)&&$(this).popover("hide")}),$("#new-record-toggle-button").popover({placement:"bottom",html:!0,trigger:"manual"}).on("shown.bs.popover",function(){var e=this;window.setTimeout(function(){return $(e).popover("hide")},5e3)})},Object.defineProperty(e,"order",{get:function(){return $(".order-radio-box:checked").data("order")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"orderBy",{get:function(){return $(".order-radio-box:checked").data("order-by")},enumerable:!0,configurable:!0}),e.reload=function(){null!==s.entries&&(c.home.clear(),c.statistics.clear(),c.home.active&&(c.home.render(),$("#statistics-filter-textbox").val("")),c.statistics.active&&c.statistics.render())},e.onEntriesLoaded=function(){$("#loading-recotw, #loading-panel-container").fadeOut(),null!==s.entries&&(s.startPolling(),e.setOptions(e.getOptions(),!1,!1,!0))},e.onEntriesLoadFailed=function(){$("#loading-panel").fadeOut().promise().done(function(){return $("#loading-error-panel").fadeIn()})},e.onRegistrationSucceeded=function(e){},e.onRegistrationFailed=function(e){$("#new-record-toggle-button").attr("data-content",String.format(r.REGISTRATION_FAILED_HTML,e)).popover("show")},e.onNewEntries=function(t){s.createNotification(t),e.onNotificationStatusChanged()},e.onNotificationStatusChanged=function(){d.title=null;var e=s.notificationCount;if(0===e)$("#unread-tweets").fadeOut();else{var t=100>e?e:"99+";$("#unread-tweets").text(t).css({display:"inline-block"})}},e.onPageBottom=function(){e.loading||(e.loading=!0,c.home.render(!0))},e.onChartSliceClick=function(e){var t=e.targetID;if(t.contains("#")){var n=+t.substring(t.indexOf("#")+1);0>n||c.statistics.applySearchFilter(s.statistics.users[n].target_sn)}},e.onNewRecordFormTextBoxValueChanged=function(){var e=$(".url-input-area"),t=$(".url-box").map(function(e,t){return t.value}).get();e.each(function(e){$(this).removeClass("has-success has-error");try{null!==s.createIDfromURL(t[e])&&$(this).addClass("has-success")}catch(n){$(this).addClass("has-error")}})},e.showNewStatuses=function(t){c.home.show();var n=e.getOptions();n.isFiltered()||2!==n.order||1!==n.orderBy?e.setOptions(new o([],"",null,!1,n.order,n.orderBy),!1,!0,!0):c.home.render(!1,t)},e._options=new o,e.loading=!1,e}();f.main()}(RecoTwExplorer||(RecoTwExplorer={}));