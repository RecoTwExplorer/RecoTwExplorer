var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},RecoTwExplorer;!function(e){"use strict";var t="RecoTw Explorer",n="2.50",r=location.protocol+"//"+location.host+location.pathname;$.fn.shake=function(e,t,n){return this.each(function(){for(var r=$(this),o=0;e>o;o++)r.animate({left:-t},n/e/4).animate({left:t},n/e/2).animate({left:0},n/e/4)})};var o=function(){function e(){}return e.INCORRECT_REGEX="指定された正規表現は正しくありません",e.INCORRECT_URL_OR_ID="指定された URL または ID は正しくありません",e.ALREADY_REGISTERED="すでに登録されているツイートです",e.REGISTRATION_AVAILABLE="このツイートは登録可能です",e.REGISTRATION_DEFAULT="ツイートの ID または URL を指定します",e.BADGE_NOT_SUPPORTED="通知バッジがサポートされていません",e.FAILED_TO_GENERATE_STATUS_URL="ツイートの URL を生成できません",e.FAILED_TO_GENERATE_USER_URL="ユーザーへの URL を生成できません",e.FAILED_TO_GENERATE_PROFILE_IMAGE_URL="プロフィール画像の URL を生成できません",e.FAILED_TO_LOAD_EMBEDDED_TWEET="Twitter 埋め込みツイートの読み込みに失敗しました",e.REGISTER_NEW_TWEET="ツイートの ID または URL:",e.REGISTRATION_FAILED_HTML="<strong>登録失敗</strong><br>{0}",e.SEARCH_HELP_HTML="<dl><dt>ツイート検索</dt><dd><code>/</code> と <code>/</code> で囲むと正規表現検索</dd><dt>ユーザー名検索</dt><dd><code>from:</code> でユーザーを検索<br>カンマ区切りで複数入力</dd><dt>ID 検索</dt><dd><code>id:</code> で ID 検索</dd></dl>",e.STATISTICS_TABLE_HTML='<span class="statistics-table-header" style="border-color: #{0:X6};"><a href="{4}">{1}</a> ({2})&nbsp;&nbsp;&ndash;&nbsp;&nbsp;{3:P1}</span><br>',e.TWEET_TIME_HTML='<a href="{0}" target="_blank"><time datetime="{2}" title="投稿時刻: {1:U} (UTC)">{1:yyyy年M月d日 HH:mm}</time></a>',e.TWEET_REMOVED_HTML='<blockquote>ツイートは削除されたか、または非公開に設定されています。<hr><div><img src="{0}"><span><a href="{1}" target="_blank">@{2}</a></span><p>{3}</p><p class="tweet-date">{4}</p></div></blockquote>',e.LINK_TO_URL_HTML='<a href="{0}" target="_blank">{0}</a>',e.URL_INPUT_AREA=$("#new-record-form .modal-body").html(),e.URL_INPUT_REGEX=new RegExp($(".url-box").attr("pattern")),e.USERNAME="ユーザ名",e.TWEETS_COUNT="ツイート数",e.NO_RESULT='<p class="text-center" style="margin-top: 200px;">該当ユーザーなし</p>',e.SEARCH_RESULT="検索結果: {0}",e.STATISTICS_COUNT="({0:N0} 件)",e.STATISTICS_COUNT_FILTERED="({0:N0} / {1:N0} 件)",e.PAGE_TITLE_SEARCH_RESULT="検索結果: {0} - "+t,e.PAGE_TITLE_NORMAL=t,e.POST_ERRORS={400:"パラメーターが正しくありません",403:"ツイートの取得に失敗しました",404:"指定されたツイートは存在しません",500:e.ALREADY_REGISTERED,503:"サーバーで問題が発生しています",UNKNOWN_ERROR:"原因不明のエラーです"},e}(),i=function(){function e(e,t,n,r,o,i){void 0===e&&(e=[]),void 0===t&&(t=""),void 0===n&&(n=null),void 0===r&&(r=!1),void 0===o&&(o=2),void 0===i&&(i=1),this.usernames=e,this.body=t,this.id=n,this.regex=r,this.order=o,this.orderBy=i}return e.prototype.isFilteredByUsernames=function(){return void 0!==this.usernames&&this.usernames.length>0},e.prototype.isFilteredByID=function(){return void 0!==this.id&&null!==this.id},e.prototype.isFilteredByBody=function(){return void 0!==this.body&&this.body.length>0},e.prototype.isFiltered=function(){return this.isFilteredByUsernames()||this.isFilteredByID()||this.isFilteredByBody()},e.prototype.toQueryString=function(){var e=[];return this.isFilteredByUsernames()&&(e[e.length]="username="+encodeURIComponent(this.usernames.join(","))),this.isFilteredByID()&&(e[e.length]="id="+encodeURIComponent(this.id)),this.isFilteredByBody()&&(this.regex?e[e.length]="body="+encodeURIComponent("/"+this.body+"/"):e[e.length]="body="+encodeURIComponent(this.body)),e.length>0?"?"+e.join("&"):""},e.prototype.toKeywords=function(){var e=[];return this.isFilteredByUsernames()&&(e[e.length]="from:"+this.usernames.join(",")),this.isFilteredByID()&&(e[e.length]="id:"+this.id),this.isFilteredByBody()&&(this.regex?e[e.length]="/"+this.body+"/":e[e.length]=this.body),e.join(" ")},e.fromQueryString=function(t,n,r){var o=new e([],"",null,!1,n,r);if(0===t.length||"?"===t)return o;var i=t.substring(1).split("&").map(function(e){return e.split("=")}).filter(function(e){return 2===e.length}).map(function(e){return{property:e[0],value:decodeURIComponent(e[1])}});return i.filter(function(e){return"body"===e.property}).forEach(function(e){var t;null!==(t=e.value.match(/^\/(.*)\/$/))?(o.body=t[1],o.regex=!0):(o.body=e.value,o.regex=!1)}),i.filter(function(e){return"username"===e.property}).forEach(function(e){return o.usernames=e.value.split(",")}),i.filter(function(e){return"id"===e.property}).forEach(function(e){return o.id=e.value}),o},e.fromKeywords=function(t,n,r){for(var o,i=new e([],"",null,!1,n,r),a=t.split(" "),s=0;s<a.length;s++)null===(o=a[s].match(/^from:([a-zA-Z0-9_]+(?:,[a-zA-Z0-9_]+)*)$/))?null===(o=a[s].match(/^id:(\d+)$/))?i.body+=a[s]:i.id=o[1]:i.usernames=o[1].split(",");return null!==(o=i.body.match(/^\/(.*)\/$/))&&(i.body=o[1],i.regex=!0),i},e}(),a=function(){function e(e){var t=this;this._length=e.count(),this._users=e.groupBy(function(e){return e.target_id}).select(function(e){return{entry:e.firstOrDefault(),count:e.count()}}).select(function(e){return{target_sn:e.entry.target_sn,count:e.count,percentage:e.count/t._length}}).orderByDescending(function(e){return e.count}).thenBy(function(e){return e.target_sn.toLowerCase()}).toArray(),this._table=new google.visualization.DataTable({cols:[{type:"string",label:o.USERNAME},{type:"number",label:o.TWEETS_COUNT}],rows:this.users.map(function(e){return{c:[{v:e.target_sn},{v:e.count}]}})})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"users",{get:function(){return this._users},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!0,configurable:!0}),e}(),s=function(){function e(e,t,n){var r=this;this._elements=e||[],this._userIDs=t||null,this._enumerable=n||Enumerable.from(e),null===t&&(this._userIDs=this.enumerable.orderByDescending(function(e){return e.tweet_id},function(e,t){return e-t}).toDictionary(function(e){return e.target_id},function(e){return e.target_sn}),this.enumerable.forEach(function(e){return e.target_sn=r._userIDs.get(e.target_id)}))}return Object.defineProperty(e.prototype,"length",{get:function(){return this._elements.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enumerable",{get:function(){return this._enumerable},enumerable:!0,configurable:!0}),e.prototype.add=function(e){if(!e)throw new Error;(0===this._elements.length||+e.id>+this._elements[this._elements.length-1].id)&&(this._elements[this._elements.length]=e)},e.prototype.addRange=function(e){e.forEach(this.add.bind(this))},e.prototype.clone=function(){return new e(this._elements,this._userIDs,this.enumerable)},e.prototype.reset=function(){return new e(this._elements,this._userIDs)},e.prototype.createStatistics=function(){return new a(this.enumerable)},e.prototype.sort=function(e){var t=this.clone();if(!e)return t;var n=e.order||2,r=e.orderBy||1,o=function(e,t){return e-t};switch(!0){case 1===n&&1===r:t._enumerable=t.enumerable.orderBy(function(e){return e.record_date});break;case 1===n&&2===r:t._enumerable=t.enumerable.orderBy(function(e){return e.tweet_id},o);break;case 2===n&&1===r:t._enumerable=t.enumerable.orderByDescending(function(e){return e.record_date});break;case 2===n&&2===r:t._enumerable=t.enumerable.orderByDescending(function(e){return e.tweet_id},o);break;case 3===n:t._enumerable=t.enumerable.shuffle()}return t},e.prototype.filter=function(e){var t=this.clone();if(void 0===e||null===e)return t;if(void 0!==e.body&&e.body.length>0)if(e.regex)try{var n=new RegExp(e.body,"i");t._enumerable=t.enumerable.where(function(e){return n.test(e.content)})}catch(r){throw new Error(o.INCORRECT_REGEX)}else t._enumerable=t.enumerable.where(function(t){return t.content.toLowerCase().contains(e.body.toLowerCase())});return void 0!==e.usernames&&e.usernames.length>0&&(t._enumerable=t.enumerable.where(function(t){return e.usernames.some(function(e){return t.target_sn.toLowerCase()===e.toLowerCase()})})),null!==e.id&&(t._enumerable=t.enumerable.where(function(t){return t.tweet_id===e.id})),t},e.prototype.memoize=function(){var e=this.clone();return e._enumerable=e.enumerable.memoize(),e},e}(),l=function(){function e(){this._length=0,this._favico=null,this._favico=new Favico({animation:"slide"})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.create=function(e){this._length+=e;try{this._favico.badge(this._length)}catch(t){console.log(t.message)}},e.prototype.clear=function(){this._length=0;try{this._favico.reset()}catch(e){console.log(e.message)}},e}(),c=function(){function e(){}return e.init=function(){e.load()},e.load=function(){var t=[],n=localStorage?localStorage.getItem("entries"):null,r=localStorage?localStorage.getItem("raw"):!1;n&&r&&(t=JSON.parse(n)),e.fetchLatestEntries(t).then(p.onEntriesLoaded,p.onEntriesLoadFailed)},e.save=function(){localStorage&&e.entries&&(localStorage.setItem("raw",JSON.stringify(!0)),localStorage.setItem("entries",JSON.stringify(e.entries.reset().enumerable.toArray())))},Object.defineProperty(e,"entries",{get:function(){return null===e._entries?null:e._entries},enumerable:!0,configurable:!0}),Object.defineProperty(e,"latestEntry",{get:function(){return null===e.entries?null:e.entries.reset().enumerable.lastOrDefault()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"statistics",{get:function(){return null===e.entries?null:null!==e._statistics?e._statistics:e._statistics=e.entries.createStatistics()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notification",{get:function(){return null!==e._notification?e._notification:e._notification=new l},enumerable:!0,configurable:!0}),Object.defineProperty(e,"options",{set:function(t){null!==e.entries&&(e._entries=e.entries.reset().sort(t).filter(t).memoize(),e._statistics=null)},enumerable:!0,configurable:!0}),e.isMobile=function(){return/iPhone|iP[ao]d|Android|Windows.*Phone/.test(navigator.userAgent)},e.createIDfromURL=function(t){var n;if(void 0===t||null===t||0===t.length)return null;if("string"==typeof t){if(null!==(n=t.match(o.URL_INPUT_REGEX)))return n[1]||n[2]}else if(Array.isArray(t)){var r=t.map(e.createIDfromURL);if(!r.every(function(e){return null===e}))return r}throw new Error(o.INCORRECT_URL_OR_ID)},e.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.unescapeHtml=function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},e.fetchLatestEntries=function(t){var n;null!==e.entries?n=+e.latestEntry.id+1:t&&t.length>0&&(n=+t[t.length-1].id+1);var r=$.Deferred();return $.ajax({url:e.RECOTW_GET_ALL_URL,dataType:"json",data:{since_id:n}}).done(function(n,o,i){null===e.entries&&(e._entries=new s(t)),n.forEach(function(t){return t.content=e.unescapeHtml(t.content)}),n.length>0&&e.entries.addRange(n),r.resolve(n)}).fail(function(e,t,n){r.reject(e)}),r.promise()},e.registerEntries=function(t){var n=$.Deferred(),r=e.createIDfromURL(t);return $.ajax({url:this.RECOTW_POST_URL,type:"POST",data:{id:r[0]},dataType:"json"}).done(function(t,r,o){+t.id===+e.latestEntry.id+1&&(delete t.result,e.entries.add(t),p.onNewEntries(1)),n.resolve(t)}).fail(function(e,t,r){var i=e.responseJSON;i&&i.errors?n.reject(o.POST_ERRORS[i.errors[0].code]||i.errors[0].message):n.reject(o.POST_ERRORS.UNKNOWN_ERROR)}),n.promise()},e.createStatusURL=function(t){if("string"==typeof t)return String.format(e.TWITTER_STATUS_URL,t);if(void 0!==t.target_sn&&void 0!==t.tweet_id)return String.format(e.TWITTER_STATUS_URL.replace("show",t.target_sn),t.tweet_id);throw new Error(o.FAILED_TO_GENERATE_STATUS_URL)},e.createUserURL=function(t){if("string"==typeof t)return String.format(e.TWITTER_USER_URL,t);if(void 0!==t.target_sn)return e.createUserURL(t.target_sn);throw new Error(o.FAILED_TO_GENERATE_USER_URL)},e.createProfileImageURL=function(t){if(null===t)return e.ALTERNATIVE_ICON_URL;if("string"==typeof t)return String.format(e.TWITTER_PROFILE_IMAGE_URL,t);if(void 0!==t.target_sn)return e.createProfileImageURL(t.target_sn);throw new Error(o.FAILED_TO_GENERATE_PROFILE_IMAGE_URL)},e.createDateByTweetID=function(t){if("string"==typeof t){var n=(+t).toString(2);return new Date(parseInt(n.substr(0,n.length-22),2)+e.TWITTER_SNOWFLAKE_EPOCH)}return void 0!==t.tweet_id?e.createDateByTweetID(t.tweet_id):null},e.setSearchQueryString=function(e){history&&history.pushState?history.pushState(null,null,location.pathname+e.toQueryString()):location.hash=e.toQueryString().slice(1)},e.startPolling=function(){null===e._pollingID&&(e._pollingID=window.setInterval(function(){e.fetchLatestEntries().done(function(e){e.length>0&&p.onNewEntries(e.length)}).fail(function(e){console.log(e)})},e.POLLING_INTERVAL))},e.stopPolling=function(){window.clearInterval(e._pollingID),e._pollingID=null},e.ALTERNATIVE_ICON_URL="./images/none.png",e.TWITTER_STATUS_URL="https://twitter.com/show/status/{0}",e.TWITTER_USER_URL="https://twitter.com/{0}",e.TWITTER_PROFILE_IMAGE_URL="/api/icon/{0}/",e.RECOTW_GET_ALL_URL="/api/recotw/1/tweet/get_tweet_all",e.RECOTW_POST_URL="/api/recotw/1/tweet/record_tweet",e.RECOTW_COUNT_URL="/api/recotw/1/tweet/count_tweet",e.POLLING_INTERVAL=2e4,e.TWITTER_SNOWFLAKE_EPOCH=1288834974657,e._entries=null,e._statistics=null,e._notification=null,e._pollingID=null,e}(),u=function(){function e(e){var t=this;this._id=e,this._$element=$("a[href='#"+e+"']").on("shown.bs.tab",function(){window.scrollTo(0,0),t.render()})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this.id===$(".tab-pane.active").attr("id")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._$element},enumerable:!0,configurable:!0}),e.prototype.show=function(){this._$element.tab("show")},e.prototype.render=function(){this.rendered=!0},e.prototype.clear=function(){this.rendered=!1},e}(),d=function(e){function t(){e.call(this,"home-tab"),this._current=0}return __extends(t,e),t.prototype.render=function(n,r){var o=this;if(n||r||!this.rendered){$("#no-result-container").hide(),p.loading=!1;var i,a=$("#main-area"),s=c.entries.enumerable;if(s.isEmpty())return void $("#no-result-container").fadeIn();r?(s=s.take(r),i=$("<div></div>").prependTo(a)):(s=s.skip(this._current).take(t.TWEETS_COUNT),i=a),twttr.ready(function(){return s.forEach(function(e){return o.renderTweet(e,i)})}),this._current+=r||t.TWEETS_COUNT,e.prototype.render.call(this)}},t.prototype.renderTweet=function(e,t){var n=this,r=$("<div></div>",{id:"recotw-tweet-"+e.tweet_id}).appendTo(t);twttr.widgets.createTweet(e.tweet_id,r[0],{lang:"ja",linkColor:"#774c80"}).then(function(t){if(t){var o=$(t.shadowRoot||t).css("height","auto").contents();o.find(".Tweet-brand .u-hiddenInNarrowEnv").hide(),o.find(".Tweet-brand .u-hiddenInWideEnv").css("display","inline-block"),o.find(".Tweet-author").css("max-width","none"),o.find(".EmbeddedTweet").css("max-width","100%")}else n.showStatusLoadFailedMessage(e,r)})},t.prototype.replaceLinkToURL=function(e){return e.replace(/[\r\n]/g,"<br>").replace(/https?:\/\/t\.co\/[A-Za-z0-9]+/g,function(e){return String.format(o.LINK_TO_URL_HTML,e)})},t.prototype.showStatusLoadFailedMessage=function(e,t){var n=c.createDateByTweetID(e),r=String.format(o.TWEET_TIME_HTML,c.createStatusURL(e),n,n.toISOString()),i=$(String.format(o.TWEET_REMOVED_HTML,c.createProfileImageURL(e),c.createUserURL(e),e.target_sn,this.replaceLinkToURL(c.escapeHtml(e.content)),r));t.empty().append(i),i.find("img").on("error",function(e){return e.target.src=c.createProfileImageURL(null)})},t.prototype.clear=function(){this._current=0,$("#main-area").empty(),e.prototype.clear.call(this)},t.TWEETS_COUNT=25,t}(u),f=function(e){function t(){e.call(this,"statistics-tab"),this._chart=null}return __extends(t,e),Object.defineProperty(t.prototype,"chart",{get:function(){return null===this._chart&&(this._chart=new google.visualization.PieChart($("#statistics-chart")[0]),google.visualization.events.addListener(this._chart,"click",p.onChartSliceClick)),this._chart},enumerable:!0,configurable:!0}),t.prototype.render=function(t){var n=this;if(c.isMobile()||void 0!==t||($("#statistics-filter-textbox").focus(),$("#statistics-table").delay(100).animate({scrollTop:0},400)),!(null===c.entries||void 0===t&&u.statistics.rendered)){$("#no-result-container").hide();var r=p.getOptions();void 0===t&&this.renderChart(r);var i=c.statistics.users.map(function(e,t){return{html:n.generateTableRow(e,r,t),screenName:e.target_sn.toLowerCase()}}).filter(function(e){return void 0===t||e.screenName.startsWith(t)});$("#statistics-table").html(i.length>0?i.map(function(e){return e.html}).join(""):o.NO_RESULT),e.prototype.render.call(this)}},t.prototype.renderChart=function(e){return e.isFiltered()?($("#statistics-filter").text(String.format(o.SEARCH_RESULT,e.toKeywords())),$("#statistics-count").text(String.format(o.STATISTICS_COUNT_FILTERED,c.statistics.length,c.entries.length))):($("#statistics-filter").text(""),$("#statistics-count").text(String.format(o.STATISTICS_COUNT,c.statistics.length))),0===c.statistics.length?($("#statistics-chart").hide(),void $("#no-result-container").fadeIn()):($("#statistics-chart").show(),void this.chart.draw(c.statistics.table,t.GRAPH_OPTIONS))},t.prototype.generateTableRow=function(e,n,a){var s=new i([e.target_sn],n.body,n.id,n.regex,n.order,n.orderBy);return String.format(o.STATISTICS_TABLE_HTML,e.percentage>t.GRAPH_OPTIONS.sliceVisibilityThreshold?t.GRAPH_COLORS[a+1]:t.GRAPH_COLORS[0],e.target_sn,e.count,e.percentage,r+s.toQueryString())},t.prototype.clear=function(){$("#statistics-table").empty(),e.prototype.clear.call(this)},t.prototype.applySearchFilter=function(t){var n=p.getOptions();n.usernames=[t],p.setOptions(n,!0,!0,!0),e.prototype.clear.call(this),u.home.show()},t.prototype.applyChartFilter=function(e){this.render(e.toLowerCase())},t.GRAPH_COLORS=[13421772,3368652,14432530,16750848,1087e3,10027161,39366,14500983,6728192,12070446,3236757,10044569,2271897,11184657,6697932,15102720,9111303,6623335,3314274,5600422,3882668,12022562,1496608,12129155,16004510,10246453,11125779,2783117,6720796,12493843,809250,7615505],t.GRAPH_OPTIONS={backgroundColor:"#FEFEFE",chartArea:{width:"90%",height:"100%"},is3D:!0,legend:"none",sliceVisibilityThreshold:.0095},t}(u),h=function(){function e(){}return Object.defineProperty(e,"title",{set:function(t){e._title=t=t||e._title,""!==location.hostname&&"localhost"!==location.hostname||(t="[DEBUG] "+t),c.notification.length>0&&(t="* "+t),document.title=t},enumerable:!0,configurable:!0}),e.setSearchKeywords=function(e){$("#search-box").val(e.toKeywords())},e.postEntriesFromModal=function(){var e=$("#new-record-modal input[type='text']").map(function(){return $(this).val()}).get();try{c.registerEntries(e.filter(function(e){return e.length>0})).then(p.onRegistrationSucceeded,p.onRegistrationFailed),$("#new-record-modal").modal("hide")}catch(t){$("#inputPostStatus").val("").focus(),$("#new-record-modal .modal-dialog").shake(2,18,300)}},e.postEntriesFromDialog=function(e){try{c.registerEntries([e]).then(p.onRegistrationSucceeded,p.onRegistrationFailed)}catch(t){window.alert(t.message)}},e._title=o.PAGE_TITLE_NORMAL,e}(),p=function(){function e(){}return e.getOptions=function(){return e._options},e.setOptions=function(t,n,r,i){try{c.options=e._options=t}catch(a){return void console.log(a.message)}r&&c.setSearchQueryString(t),i&&h.setSearchKeywords(t),t.isFiltered()?($("#clear-search-filter").show(),h.title=String.format(o.PAGE_TITLE_SEARCH_RESULT,t.toKeywords())):($("#clear-search-filter").hide(),h.title=o.PAGE_TITLE_NORMAL),$("#statistics-filter-textbox").val(""),null!==c.entries&&(u.statistics.active?(u.home.clear(),n||e.reload()):e.reload())},e.main=function(){h.title=o.PAGE_TITLE_NORMAL,$("#app-version").text(n),c.init(),u.home=new d,u.statistics=new f,e.setOptions(i.fromQueryString(location.search,2,1),!1,!1,!0),google.load("visualization","1.0",{packages:["corechart"]}),$("#loading-recotw").show();var t=$(window);t.unload(c.save),t.bottom({proximity:.05}),t.on("orientationchange",function(){$(document.body).toggleClass("standalone",window.innerHeight>=window.screen.height&&navigator.standalone)}).trigger("orientationchange"),t.on("bottom",function(){u.home.active&&e.onPageBottom()}),t.on("popstate",function(){e.setOptions(i.fromQueryString(location.search,e.order,e.orderBy),!1,!1,!0)}),u.home.element.click(function(){if(u.home.active){var t=c.notification.length;t?(c.notification.clear(),e.onNotificationStatusChanged(),e.showNewStatuses(t)):$("html, body").animate({scrollTop:0},400)}}),$(".navbar-brand, #clear-search-filter").click(function(){e.setOptions(i.fromKeywords("",e.order,e.orderBy),!1,!0,!0)}),$("[id^='order-by-']").change(function(){e.getOptions().order=e.order,e.getOptions().orderBy=e.orderBy,e.setOptions(e.getOptions(),!0,!1,!1)}),$("#order-shuffle").click(function(){e.getOptions().order=e.order,e.setOptions(e.getOptions(),!0,!1,!1)}),$("#search-form").submit(function(t){t.preventDefault(),e.setOptions(i.fromKeywords($("#search-box").val(),e.order,e.orderBy),!1,!0,!1)}),$("#search-form-toggle-button").click(function(){var e=$(this),t=$("#search-form"),n=$("#page-main");e.hasClass("active")?(e.removeClass("active"),n.removeClass("main-search-active"),t.css({display:""})):(e.addClass("active"),n.addClass("main-search-active"),t.css({cssText:"display: block !important"}))}),$("#new-record-toggle-button").click(function(){if(navigator.standalone){var e=window.prompt(o.REGISTER_NEW_TWEET);null!==e&&h.postEntriesFromDialog(e)}else $("#new-record-modal").modal("show")}),$("#new-record-form").submit(function(e){e.preventDefault(),h.postEntriesFromModal()}),$("#new-record-modal").on("shown.bs.modal",function(){$("#new-record-form .url-box").focus()}),$("#new-record-modal").on("hidden.bs.modal",function(){$("#new-record-form .modal-body").empty().html(o.URL_INPUT_AREA)}),$("#new-record-modal").on("keyup change input",".url-box",e.onNewRecordFormTextBoxValueChanged),$("#statistics-filter-textbox").on("keyup change input",function(e){u.statistics.applyChartFilter(e.target.value)}),$("#statistics-table").on("mousedown click",".statistics-table-header a",function(e){return"click"===e.type?void e.preventDefault():void(0===e.button&&u.statistics.applySearchFilter(e.target.textContent))}),$("#search-box").popover({placement:"bottom",html:!0,content:o.SEARCH_HELP_HTML}).blur(function(){$(this).popover("hide")}).keydown(function(e){13!==e.keyCode&&27!==e.keyCode||$(this).popover("hide")}),$("#new-record-toggle-button").popover({placement:"bottom",html:!0,trigger:"manual"}).on("shown.bs.popover",function(){var e=this;window.setTimeout(function(){return $(e).popover("hide")},5e3)})},Object.defineProperty(e,"order",{get:function(){return $(".order-radio-box:checked").data("order")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"orderBy",{get:function(){return $(".order-radio-box:checked").data("order-by")},enumerable:!0,configurable:!0}),e.reload=function(){null!==c.entries&&(u.home.clear(),u.statistics.clear(),u.home.active&&(u.home.render(),$("#statistics-filter-textbox").val("")),u.statistics.active&&u.statistics.render())},e.onEntriesLoaded=function(){$("#loading-recotw, #loading-panel-container").fadeOut(),null!==c.entries&&(c.startPolling(),e.setOptions(e.getOptions(),!1,!1,!0))},e.onEntriesLoadFailed=function(){$("#loading-panel").fadeOut().promise().done(function(){return $("#loading-error-panel").fadeIn()})},e.onRegistrationSucceeded=function(e){},e.onRegistrationFailed=function(e){$("#new-record-toggle-button").attr("data-content",String.format(o.REGISTRATION_FAILED_HTML,e)).popover("show")},e.onNewEntries=function(t){c.notification.create(t),e.onNotificationStatusChanged()},e.onNotificationStatusChanged=function(){h.title=null;var e=c.notification.length;if(0===e)$("#unread-tweets").fadeOut();else{var t=100>e?e:"99+";$("#unread-tweets").text(t).css({display:"inline-block"})}},e.onPageBottom=function(){e.loading||(e.loading=!0,u.home.render(!0))},e.onChartSliceClick=function(e){var t=e.targetID,n=t.indexOf("#");if(!(0>n)){var r=+t.substring(n+1);0>r||u.statistics.applySearchFilter(c.statistics.users[r].target_sn)}},e.onNewRecordFormTextBoxValueChanged=function(e){var t=$(this).parents(".url-input-area").removeClass("has-success has-warning has-error"),n=e.target;try{var r=c.createIDfromURL(n.value);c.entries.reset().enumerable.any(function(e){return e.tweet_id===r})?t.addClass("has-warning").find(".help-block").text(o.ALREADY_REGISTERED):null!==r?t.addClass("has-success").find(".help-block").text(o.REGISTRATION_AVAILABLE):t.find(".help-block").text(o.REGISTRATION_DEFAULT)}catch(i){t.addClass("has-error").find(".help-block").text(o.INCORRECT_URL_OR_ID)}},e.showNewStatuses=function(t){u.home.show();var n=e.getOptions();n.isFiltered()||2!==n.order||1!==n.orderBy?e.setOptions(new i([],"",null,!1,n.order,n.orderBy),!1,!0,!0):(c.options=n,u.home.render(!1,t))},e._options=new i,e.loading=!1,e}();p.main()}(RecoTwExplorer||(RecoTwExplorer={}));